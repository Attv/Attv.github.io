---

layout:     post
title:      Mysql初探
subtitle:   mysql事物·优化·锁
date:       2019-08-20
author:     attv
header-img: img/post-bg-ios9-web.jpg
catalog: true
tags:
    - Mysql
    - 分布式存储

---

## mysql索引

@(mysql)

### 特性
 * 可插拔
 * 可单表指定
 * 在数据区产生frm文件

### 分类
 * csv
    - 数据的快速导入导出,表格直接转换成CSV
 * arz
    - 日志系统,大量设备数据采集
 * memary
 * myisam
    - 查询的个数不需要进行全表扫描
    - 数据和索引分开储存
    - 表级锁
    - 不支持事物
 * innodb
    - 支持聚簇索引
    - 支持数据缓存
    - 支持外键
    - 支持行级锁
    - 支持MVCC多版本控制

## Mysql优化
### 查询执行的路径


> 1.通信方式

客户端与服务端的通信方式采用的是'半双工'

> 2.查询缓存

原理：缓存的select操作的结果集和sql语句
过程：当有新的sql语句进行查询的时候，会先来查询缓存，判断是否存在可用的记录集
判断标准：sql语句必须一致，这里区分大小写空格等。

> 3.当数据不会被缓存的情况下
* 当查询的是不确定的数据的时候，如查询系统的函数
* 查询的结果大于query_cache_limit
* 当一个事务修改了表的时候，事务提交之前，和这个表相关的查询都不会被缓存起来(InnoDB)
* 查询系统表
* 查询语句不涉及到表的时候

> 4.mysql的查询优化处理
* 解析sql:通过lex语法将sql解析成语法树。
* 预处理阶段：进一步检查语法树的合法性。
* 查询优化器：查找最优的执行计划
* 查询执行引擎
* 返回客户端


## mysql查询优化-执行计划
### 执行计划Id
> 标识执行的顺序
* 当id相同的情况下执行顺序从上到下
* 当id不相同的情况下id递增 越大执行的优先级越高

### 执行计划select_type
* **SIMPLE**:简单的select查询
* **PRIMARY**:查询包含子查询部分，最外层标记为primary
* **SUBQUERY/MATERIALIZED**:SUBQUERY标识在select或where列表包含了子查询，MATERIALIZED标识where后面in条件的子查询。
* **UNION**:若第二个select出现在union之后，则被标记为union
* **UNION RESULT**:从union表中获取结果的result

### 执行计划——table
> 涉及到查询的表名或者表的别名：
<unionM,N> 由ID为M,N查询union产生的结果，由ID为N产生的结果

### 执行计划-type
> 访问类型，sql查询优化中一个很重要的指标，结果值从好到坏依次是：
```sql
system > const > eq_ref > ref > range > index > ALL

```
* system:表示只有一行记录（等于系统表），const类型的特例，基本不会出现，可以忽略不计
* const:表示通过一次索引就找到了，const用于比较primary key或者unique索引
* eq_ref:唯一索引扫描，对于每个索引键，表中只有一条记录与之匹配。常见用于主键或者唯一索引扫描
* ref:非唯一索引扫描，可返回匹配摸个单独值的所有行，本质也是一种索引访问
* range:只检索给定范围的行，使用一个索引来选择行
* index:Full Index Scan 索引全表扫描 把索引从头到尾扫描一遍
* All:Full Table Scan,遍历全表以找到匹配的行。

